<div class="pagetitle">
  <h1>Gestion de Usuarios</h1>
</div>
<section class="section dashboard">
  <div class="card separador-componentes">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Usuarios</h5>
        <p-table
          #dt1
          [value]="lsListado"
          dataKey="id_usuario"
          [rows]="10"
          [showCurrentPageReport]="true"
          [rowsPerPageOptions]="[10, 25, 50]"
          [paginator]="true"
          currentPageReportTemplate="Mostrar {first} - {last} de {totalRecords} elementos"
          [globalFilterFields]="['id_usuario ','nombre', 'email','nombre_rol','activo']"
          [scrollable]="true"
          scrollHeight="500px"
          [tableStyle]="{ 'min-width': '40rem' }"
          [sortMode]="'single'"
        >
            <ng-template pTemplate="caption">
            <div class="flex">
              <button pButton label="Limpiar" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
              <span class="p-input-icon-left ml-auto">
                <input  type="text" (input)="applyFilter($event)" placeholder="Buscar" />
              </span>
              <div class="p-toolbar-group-end">
                <p-button
                  type="button"
                  icon="pi pi-plus"
                  styleClass="p-button-text"
                  (click)="ModalNuevoInformacion()"
                ></p-button>
              </div>          
            </div>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="id_usuario">
                    <div class="flex align-items-center">
                        Id <p-sortIcon field="ofertas_id"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="nombre">
                  <div class="flex align-items-center">
                      Usuarios <p-sortIcon field="nombre"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="email">
                    <div class="flex align-items-center">
                        Correo Electronico <p-sortIcon field="email"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="nombre_rol">
                  <div class="flex align-items-center">
                      Rol <p-sortIcon field="nombre_rol"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="estado">
                  <div class="flex align-items-center">
                      Estado <p-sortIcon field="estado"></p-sortIcon>
                  </div>
                </th>
                <th>
                  <div class="flex align-items-center">
                      Gesti칩n
                  </div>
                </th>
            </tr>
        </ng-template>
      <ng-template pTemplate="body" let-customer>
        <tr>
          <td>{{ customer.id_usuario }}</td>
          <td>{{ customer.nombre }}</td>
          <td>{{ customer.email }}</td>
          <td>{{ customer.nombre_rol }}</td>
          <td>
            <p-tag *ngIf="customer.activo == false" severity="danger" [value]="'DESACTIVADO'"></p-tag>
            <p-tag *ngIf="customer.activo == true" severity="success" [value]="'ACTIVO'"></p-tag>
          <td>
            <p-button
              type="button"
              icon="pi pi-pencil"
              styleClass="p-button-text"
              (click)="ModalEditarInformacion(customer)"
            ></p-button>
            <p-button
              type="button"
              icon="pi pi-trash"
              styleClass="p-button-text"
              (click)="ModalCambiarEstado(customer)"
            ></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="5">No se encontraron usuarios.</td>
        </tr>
      </ng-template>
      
      </p-table>
    </div> 
  </div>
  <p-dialog
    header="Nuevo"
    [(visible)]="visibleNuevo"
    [modal]="true"
    [style]="{ width: '50vw', minWidth: '300px', maxWidth: '80vw' }"
    [draggable]="false"
    [resizable]="false"
  >
  <ng-template pTemplate="header">
    <span class="text-xl font-bold">Nuevo Usuario</span>
  </ng-template>
  <ng-template pTemplate="content">
    <label for="Nombre" class="form-label" style="font-size: 14px;">Nombre: </label>
    <div class="p-inputgroup">
      <span class="p-inputgroup-addon">
          <i class="pi pi-pencil"></i>
      </span>
      <input pInputText id="Nombre" placeholder="Juan Perez" minlength="10" [(ngModel)]="nombre" class="form-control" (input)="nombre = nombre" required/>
    </div>
    <label for="Email" class="form-label" style="font-size: 14px;">Correo Electronico:  </label>
    <div class="p-inputgroup" >
      <span class="p-inputgroup-addon">
          <i class="pi pi-pencil"></i>
      </span>
      <input type="email" 
      id="Email" 
      placeholder="ejemplo@gmail.com"
      [(ngModel)]="email" 
      class="form-control" 
      (input)="email = email" 
      pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
      required/>
    </div>
    <label for="contrasena" class="form-label" style="font-size: 14px;">Contrase침a:  </label>
    <div class="p-inputgroup" >
      <span class="p-inputgroup-addon">
          <i class="pi pi-pencil"></i>
      </span>
      <input type="password" 
      id="contrasena"  
      [(ngModel)]="contrasena" 
      class="form-control" 
      (input)="contrasena = contrasena"
      pattern="^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,32}$"
      required/>
    </div>
    <label for="negocio" class="form-label" style="font-size: 14px;">Rol:  </label>
    <div class="p-inputgroup">
      <span class="p-inputgroup-addon">
        <i class="pi pi-pencil"></i>
      </span>
      <!-- <select id="negocio" required (change)="onNegocioChange($event)" [(ngModel)]="id_usuario" class="form-control">
        <option value="0" disabled [selected]="id_usuario === 0">Elegir Rol</option>
        <option *ngFor="let negocio of negocios" [value]="negocio.negocio_id">{{ negocio.nombre }}</option>
      </select> -->
    </div>
    <div class="col-12 d-flex justify-content-center mt-3">
      <button class="btn btn-primary w-50" type="submit">Registrar</button>
    </div>    
  </ng-template>
  
  
  </p-dialog>
  <p-dialog
    header="Actualizaci칩n"
    [(visible)]="visibleEditar"
    [modal]="true"
    [style]="{ width: '50vw', minWidth: '300px', maxWidth: '80vw' }"
    [draggable]="false"
    [resizable]="false"
  >
  <ng-template pTemplate="header">
    <span class="text-xl font-bold">Actualizaci칩n Usuario</span>
  </ng-template>

  <label for="descripact" class="form-label" style="font-size: 14px;">Nombre:  </label>
  <div class="p-inputgroup">
    <span class="p-inputgroup-addon">
        <i class="pi pi-pencil"></i>
    </span>
    <input pInputText id="descripact" placeholder="Descripcion" [(ngModel)]="objSeleccion.nombre" class="form-control" (input)="nombre = nombre" minlength="10" required/>
  </div>
  <label for="Email" class="form-label" style="font-size: 14px;">Correo Electronico: </label>
    <div class="p-inputgroup">
      <span class="p-inputgroup-addon">
          <i class="pi pi-pencil"></i>
      </span>
      <input type="email" id="Email" placeholder="Green Coins Necesarios" [(ngModel)]="objSeleccion.email" class="form-control" required/>
    </div>
    
  <label for="negocioact" class="form-label" style="font-size: 14px;">Rol:  </label>
  <div class="p-inputgroup">
    <span class="p-inputgroup-addon">
      <i class="pi pi-pencil"></i>
    </span>
    <!-- <select required id="negocioact" (change)="onNegocioChangeAct($event)" >
      <option value="0" disabled [selected]="id_usuario === 0">Elegir Negocio</option>
      <option *ngFor="let negocio of negocios" [value]="negocio.negocio_id">{{ negocio.nombre }}</option>
    </select> -->
  </div>
  <div class="col-12 d-flex justify-content-center mt-3">
    <button class="btn btn-primary w-50" type="submit">Actualizar</button>
  </div>
  
  </p-dialog>
  <p-dialog
    header="Estado"
    [(visible)]="visibleEstado"
    [modal]="true"
    [style]="{ width: '50vw', minWidth: '300px', maxWidth: '80vw' }"
    [draggable]="false"
    [resizable]="false"
  >
  <ng-template pTemplate="header">
    <span class="text-xl font-bold">{{strEstado}} Usuario</span>
  </ng-template>
  <ng-template pTemplate="content">
    <div class="p-inputgroup" style="margin-top: 15px;">
      <span class="p-inputgroup-addon">
        Nombre:
      </span>
      <input pInputText  [(ngModel)]="objSeleccion.nombre" class="p-inputtext-sm" readonly/>
    </div>
    <div class="p-inputgroup" style="margin-top: 15px;">
      <span class="p-inputgroup-addon">
        Correo Electronico:
      </span>
      <input pInputText  [(ngModel)]="objSeleccion.email" class="p-inputtext-sm" readonly/>
    </div>
    <div class="p-inputgroup" style="margin-top: 15px;">
      <span class="p-inputgroup-addon">
        Rol:
      </span>
      <input pInputText [(ngModel)]="objSeleccion.nombre_rol" class="p-inputtext-sm" readonly/>
    </div>
    <div class="col-12 d-flex justify-content-center mt-3">
      <button class="btn btn-primary w-50" type="submit">Eliminar</button>
    </div>
  </ng-template>
  
  
  
  </p-dialog>
  </div>
</section>